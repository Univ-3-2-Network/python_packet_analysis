services:
  py_cap:
    build:
      context: .
      args:
        - SSH_ROOT_PASSWORD=${SSH_ROOT_PASSWORD}
    container_name: py_cap
    # Grant network capabilities required for packet sniffing
    cap_add:
      - NET_ADMIN
      - NET_RAW
    # Use host network mode for full network access (optional, but recommended for sniffing)
    # Enable this to see real network routes in traceroute
    network_mode: "host"

    # If not using host mode, expose ports manually (ports are ignored in host mode)
    # ports:
    #   - "${SSH_PORT}:22"
    #   - "${APP_PORT}:${APP_PORT}"

    # Keep container running
    stdin_open: true
    tty: true

    # Restart policy
    restart: unless-stopped

    # Optional: mount volumes for persistent data
    volumes:
      - ./app:/app
      - ./captured_packets:${CAPTURED_PACKETS_DIR}
      - ./logs:/app/logs

    # Environment variables from .env file
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHON_ENV=${PYTHON_ENV}
      - APP_PORT=${APP_PORT}
      - NETWORK_INTERFACE=${NETWORK_INTERFACE}
      - CAPTURE_FILTER=${CAPTURE_FILTER}
      - MAX_PACKETS=${MAX_PACKETS}
      - LOG_LEVEL=${LOG_LEVEL}
      - LOG_FILE=${LOG_FILE}
      - CAPTURED_PACKETS_DIR=${CAPTURED_PACKETS_DIR}

    # Load environment variables from .env file
    env_file:
      - .env
